var parse = require('../configuration/connectionString').parse,
    expect = require('chai').expect,
    adoNet = 'Server=tcp:azure-mobile-apps-test.database.windows.net,1433;Database=e2etest-v2-node;User ID=azure-mobile-apps-test@azure-mobile-apps-test;Password=abc123;Encrypt=True;TrustServerCertificate=False;Connection Timeout=30;',
    odbc = 'Driver={SQL Server Native Client 11.0};Server=tcp:azure-mobile-apps-test.database.windows.net,1433;Database=e2etest-v2-node;Uid=azure-mobile-apps-test@azure-mobile-apps-test;Pwd=abc123;Encrypt=yes;TrustServerCertificate=no;Connection Timeout=30;',
    expected = {
        provider: 'sql',
        user: 'azure-mobile-apps-test@azure-mobile-apps-test',
        password: 'abc123',
        server: 'azure-mobile-apps-test.database.windows.net',
        port: 1433,
        database: 'e2etest-v2-node',
        connectionTimeout: 30000,
        options: {
            encrypt: true
        }
    };

describe('azure-mobile-apps.core.configuration.connectionString', function () {
    describe('parse', function () {
        it('parses relevant sections of ADO.NET connection strings', function () {
            expect(parse(adoNet)).to.deep.equal(expected);
        });

        it('parses relevant sections of ODBC connection strings', function () {
            expect(parse(odbc)).to.deep.equal(expected);
        });

        it('parses server attributes correctly', function () {
            expect(parse('Server=tcp:azure-mobile-apps-test.database.windows.net,1433').server).to.equal('azure-mobile-apps-test.database.windows.net');
            expect(parse('Server=azure-mobile-apps-test.database.windows.net,1433').server).to.equal('azure-mobile-apps-test.database.windows.net');
            expect(parse('Server=tcp:azure-mobile-apps-test.database.windows.net').server).to.equal('azure-mobile-apps-test.database.windows.net');
            expect(parse('Server=azure-mobile-apps-test.database.windows.net').server).to.equal('azure-mobile-apps-test.database.windows.net');
        });
    });
});
