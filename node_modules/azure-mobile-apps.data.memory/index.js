var promises = require('azure-mobile-apps.core/promises'),
    tables = {};

module.exports = function (configuration) {
    return {
        get: function (query) {
            var table = items(query.table);

            // need to evaluate query against each item before returning
            return promises.resolved(Object.keys(table).map(function (id) { return table[id] }));
        },
        patch: function (table, item) {
            items(table)[item.id] = item;
            return promises.resolved(item);
        },
        post: function (table, item) {
            items(table)[item.id] = item;
            return promises.resolved(item);
        },
        delete: function (table, id, version) {
            delete items(table)[item.id];
            return promises.resolved();
        }
    }

    function items(table) {
        if(!tables[table])
            tables[table] = {};
        return tables[table];
    }
}
