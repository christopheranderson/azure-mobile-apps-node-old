var promises = require('azure-mobile-apps.core/promises'),
    tables = {};

module.exports = function () {
    return {
        read: function (table, query) {
            // need to evaluate query against each item before returning
            return promises.resolved(values(table));
        },
        update: function (table, item) {
            items(table)[item.id] = item;
            return promises.resolved(item);
        },
        insert: function (table, item) {
            items(table)[item.id] = item;
            return promises.resolved(item);
        },
        delete: function (table, id, version) {
            delete items(table)[id];
            return promises.resolved(1);
        }
    }

    function items(table) {
        var name = table.name.toLowerCase();
        if(!tables[name])
            tables[name] = {};
        return tables[name];
    }

    function values(table) {
        var tableItems = items(table);
        return Object.keys(tableItems).map(function (id) {
            return tableItems[id];
        });
    }
}
