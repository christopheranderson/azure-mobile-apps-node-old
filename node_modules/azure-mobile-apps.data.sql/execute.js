var mssql = require('mssql'),
    promises = require('azure-mobile-apps.core/promises');

module.exports = function (config, statement) {
    return promises.create(function (resolve, reject) {
        var connection = new mssql.Connection(config, function(err) {
            if(err) {
                reject(err);
                return;
            }

            var request = connection.request();

            statement.parameters && statement.parameters.forEach(function (parameter) {
                request.input(parameter.name, parameter.value);
            })

            request.query(statement.sql, function(err, recordset) {
                if(err)
                    reject(err);
                else
                    resolve(recordset);
            });
        });
    });
};
