var helpers = require('../helpers'),
    _ = require('underscore');

module.exports = function (table, id, version, tableConfig) {
    tableConfig = tableConfig || {};
    var tableName = helpers.formatTableName(tableConfig.schema || 'dbo', table),
        deleteStmt = _.sprintf("DELETE FROM %s WHERE [id] = ?", tableName),
        parameters = [id];

    if (tableConfig.softDelete) {
        deleteStmt = _.sprintf("UPDATE TOP (1) %s SET [__deleted] = 1 WHERE [id] = ? AND [__deleted] = 0", tableName);
    }

    if (version) {
        deleteStmt += " AND [__version] = ? ";
        parameters.push(version);
    }

    return {
        sql: deleteStmt,
        parameters: parameters
    };
};
