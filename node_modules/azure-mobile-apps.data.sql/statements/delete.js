var helpers = require('../helpers');

module.exports = function (table, id, version, tableConfig) {
    tableConfig = tableConfig || {};
    var tableName = helpers.formatTableName(tableConfig.schema || 'dbo', table),
        deleteStmt = "DELETE FROM " + tableName + " WHERE [id] = @id",
        parameters = [{ name: 'id', value: id }];

    if (tableConfig.softDelete) {
        deleteStmt = "UPDATE TOP (1) " + tableName + " SET [__deleted] = 1 WHERE [id] = @id AND [__deleted] = 0";
    }

    if (version) {
        deleteStmt += " AND [__version] = @__version ";
        parameters.push({ name: '__version', value: version });
    }

    deleteStmt += '; SELECT @@rowcount AS __rowcount';

    return {
        sql: deleteStmt,
        parameters: parameters
    };
};
