var expect = require('chai').expect;

describe('azure-mobile-apps.data.sql.operations', function () {
    describe('insert', function () {
        var insert = require('../operations/insert');

        it('generates simple statement and parameters', function () {
            var statement = insert('table', { id: 'id', p1: 'value' });
            expect(statement.sql).to.equal('INSERT INTO [dbo].[table] ([id],[p1]) VALUES (?,?); SELECT * FROM [dbo].[table] WHERE [id] = ?');
            expect(statement.parameters).to.deep.equal(['id', 'value', 'id']);
        })
    })

    describe('update', function () {
        var update = require('../operations/update');

        it('generates simple statement and parameters', function () {
            var statement = update('table', { id: 'id', p1: 'value' });
            expect(statement.sql).to.equal('UPDATE [dbo].[table] SET [p1] = ? WHERE [id] = ? ; SELECT @@rowcount as __rowcount; SELECT * FROM [dbo].[table] WHERE [id] = ?');
            expect(statement.parameters).to.deep.equal(['value', 'id', 'id']);
        })
    })

    describe('delete', function () {
        var del = require('../operations/delete');

        it('generates simple statement and parameters', function () {
            var statement = del('table', 'id');
            expect(statement.sql).to.equal('DELETE FROM [dbo].[table] WHERE [id] = ?');
            expect(statement.parameters).to.deep.equal(['id']);
        })
    })
})
