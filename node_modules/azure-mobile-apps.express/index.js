var tables = require('./tables'),
    table = require('./tables/configurationFactory'),
    promises = require('azure-mobile-apps.core/promises');

module.exports = function (configuration) {
    configuration = configuration || {};
    
    var tableMiddleware = tables(configuration);

    return {
        tables: tableMiddleware,
        table: table,
        attach: function (app) {
            app.use(configuration.tableRootPath || '/tables', tableMiddleware);
        }
    };
};

// static exports
module.exports.table = table;