var express = require('express'),
    executeOperation = require('../middleware/executeOperation');

// generates the set of middleware from specified configuration to handle requests for this table
module.exports = function (configuration, router) {
    configureOperation('get', 'read');
    configureOperation('post', 'insert');
    configureOperation('patch', 'update');
    configureOperation('delete', 'delete');
    
    // if no execute middleware has been configured, just use the router we configured    
    return configuration.middleware.length === 0 
        ? [router]
        : configuration.middleware;

    function configureOperation(verb, operation) {
        var configuredMiddleware = configuration[operation] || [],
            // if no middleware has been configured, just use the executeOperation middleware
            middleware = configuredMiddleware.length === 0 
                ? [executeOperation] 
                : configuredMiddleware;
        
        router[verb]('/', middleware);
    }
}
