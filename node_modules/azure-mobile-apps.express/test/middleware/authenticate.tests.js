var middleware = require('../../middleware/authenticate'),
    expect = require('chai').expect,
    secret = 'secret', // token and secret are taken directly from http://jwt.io/
    token = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWV9.TJVA95OrM7E2cBab30RMHrHDcEfxjoYZgeFONFh7HgQ',
    config = { auth: { secret: secret } };

describe('azure-mobile-apps.express.middleware.authenticate', function () {
    it("populates context.user with validated claims", function (done) {
        var req = { headers: { 'x-zumo-auth': token } };
        middleware(config)(req, null, function () {
            try {
                expect(req.azureMobile.user).to.deep.equal({
                    "sub": "1234567890",
                    "name": "John Doe",
                    "admin": true
                });
                done();
            } catch(err) {
                done(err);
            }
        });
    });
});
