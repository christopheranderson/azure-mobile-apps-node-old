var core = require('azure-mobile-apps.core'),
    path = require('path'),

    platforms = {
        express: require('azure-mobile-apps.express'),
    },

    defaults = {
        platform: 'express',
        basePath: path.dirname(module.parent.filename),
        promiseConstructor: Promise,
        tableRootPath: '/tables',
        data: { }
    };

module.exports = function (configuration) {
    configuration = core.utilities.assign(core.configuration.fromFile('azureMobile'), defaults, configuration);
    core.configuration.fromEnvironment(configuration);
    core.logger.initialise(configuration.logging);

    return platforms[configuration.platform](configuration);
};
