var path = require('path')
    fs = require('fs');

module.exports = {
    loadPath: function (target, targetPath) {
        var fullPath = path.resolve(path.dirname(module.parent.filename), targetPath);
        
        // this won't work with other extensions (e.g. .ts, .coffee)
        // perhaps we should use require.resolve here instead - also enables loading modules in other packages
        if (!fs.existsSync(fullPath)) {
            if (fs.existsSync(fullPath + '.js'))
                fullPath += '.js';
            else
                throw new Error('Requested configuration path (' + fullPath + ') does not exist');
        }

        if (fs.statSync(fullPath).isDirectory())
            loadDirectory(target, fullPath);
        else
            loadModule(target, fullPath);

        return target;
    }
}

function loadModule(target, targetPath) {
    var moduleName = path.basename(targetPath, path.extname(targetPath)),
        loadedModule = require(targetPath);
    target[moduleName] = loadedModule;
}

function loadDirectory(target, targetPath) {
    fs.readdirSync(targetPath).forEach(function (iterationPath) {
        var fullPath = path.join(targetPath, iterationPath);
        if (fs.statSync(fullPath).isDirectory())
            loadDirectory(target, fullPath);
        else
            loadModule(target, fullPath);
    });
}
