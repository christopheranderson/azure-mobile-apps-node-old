var logger = require('zumo.core/logger'),
    path = require('path'),
    platforms = {
        express: require('zumo.express'),
        restify: require('zumo.restify')
    };

module.exports = function (configuration) {
    configuration = configuration || {};
    configuration.basePath = configuration.basePath || path.dirname(module.parent.filename);
    configuration.debug = configuration.debug || debugMode();
    
    logger.initialise(configuration.logging);

    // by default, return the express middleware implementation
    return platforms[configuration.platform || 'express'](configuration);
};

function debugMode() {
    return process.execArgv.some(function (arg) {
        return arg.indexOf('--debug') === 0;
    });
}